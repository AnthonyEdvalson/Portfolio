<!DOCTYPE html>
<html class="black" lang="en">
    <!--

         _      _     _                            _
        | |    | |___| | ___ ___  _ __ ___   ___  | | 
        | | /\ | | _ \ |/ __/ _ \| '_ ` _ \ / _ \ | |
         \ V  V /  __/ | (_| (_) | | | | | |  __/ |_|
          \_/\_/ \___|_|\___\___/|_| |_| |_|\___| (_)

        I've hidden a few easter eggs on the site, let me know if you find them all!

        Stay awesome :)

    -->
    <head>
        <meta charset="UTF-8">
        <title>Tony Edvalson</title>
        <meta name="description" content="Tony Edvalson's personal website">
        <meta name="author" content="Tony Edvalson">
        <meta name="copyright" content="Tony Edvalson">
        <meta name="keywords" content="Tony Edvalson, software engineer, machine learning, personal website, projects, portfolio">
        <meta name="theme-color" content="#0a0a0a" id="theme-color">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-M50JEYPFZE"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
    
            gtag('config', 'G-M50JEYPFZE');
        </script> 

        <link rel="stylesheet" href="site.css">
        <link rel="icon" href="favicon/fav-black.png" type="image/png" id="favicon">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preonnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

        <script>
            window.onload = function() {
                let name = new URLSearchParams(window.location.search).get("hello");
                if (name) {
                    const hello = document.getElementById('hello');
                    hello.innerText = `Hello, ${name}!`;
                }

                // Gotta protect my email from those pesky bots
                let parts = [
                    "dG9ueWVkdmF",
                    "sc29uQGdtYW",
                    "lsLmNvbQ=="
                ];
                let value = atob(parts.join(''));
                let e = document.getElementsByClassName("em");
                for (let i = 0; i < e.length; i++) {
                    e[i].innerText = value;
                    e[i].href = `mailto:${value}`;
                    // e[i].addEventListener("click", () => {
                    //     navigator.clipboard.writeText(value);
                    // });
                }
            }
        

            function setTheme(themeName) {
                if (themeName !== "rainbow") {
                    localStorage.setItem('theme', themeName);
                }
                document.documentElement.className = themeName;
                document.getElementById('favicon').href = `favicon/fav-${themeName}.png`;
                document.getElementById('theme-color').content = getComputedStyle(document.documentElement).getPropertyValue("--base");
                broadcastTheme();
            }

            function broadcastTheme() {
                const style = getComputedStyle(document.documentElement);
                const themeData = {
                    type: "theme",
                    vars: {
                        "--color-blackest": style.getPropertyValue("--color-blackest").trim(),
                        "--color-black": style.getPropertyValue("--color-black").trim(),
                        "--color-white": style.getPropertyValue("--color-white").trim(),
                        "--accent": style.getPropertyValue("--accent").trim(),
                    },
                    rainbow: document.documentElement.classList.contains("rainbow"),
                };
                document.querySelectorAll("iframe").forEach(function(iframe) {
                    if (iframe.contentWindow) {
                        iframe.contentWindow.postMessage(themeData, "*");
                    }
                });
            }

            window.addEventListener('load', () => {
                let theme = localStorage.getItem('theme') || "black";
                setTheme(theme);
            });
        </script>
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    </head>
    <body>
        <div class="grid-bg"></div>
        <div id="secret-pixel" title=" "></div>
        
        <div id="screensaver-canvas-container" style="display: none;">
            <canvas id="screensaver-canvas-webgl"></canvas>
            <canvas id="screensaver-canvas-2d" style="pointer-events: none"></canvas>
        </div>
        <div id="grid"></div>

        <div id="modal" class="modal" hidden>
            <div class="modal__phantom"></div>
            <button class="modal__close" aria-label="Close">&times;</button>
            <div class="modal__content">
                <span class="modal__code"></span>
                <span class="modal__category"></span>
                <h1 class="modal__title"></h1>
                <p class="modal__subtitle"></p>
                <div class="modal__body markdown"></div>
            </div>
        </div>

        <div class="subfooter">
            <span id="subfooter-msg"></span>
        </div>

        <div id="image-zoom" class="image-zoom">
            <button class="image-zoom__close" aria-label="Close">&times;</button>
            <div class="image-zoom__inner">
                <img class="image-zoom__img" src="" alt="">
            </div>
        </div>
        
        <!-- Miscellenous scripts, the stuff down here is for things that shouldn't block the rendering of the page -->
        <script>
            console.log("Yahaha! You found me! üå±")
        </script>
        <script src="grid-data.js"></script>
        <script>
            const THEMES = [
                "orange",
                "blue",
                "teal",
                "rose",
                "rainbow",
                "classic"
            ];

            function renderItemMarkdown(markdown) {
                const renderer = new marked.Renderer();

                renderer.link = ({href, title, text}) => {
                    let html = `<a href="${href}"`;
                    if (title) {
                        html += ` title="${title}"`;
                    }
                    html += ` target="_blank">${text}</a>`;
                    return html;
                };

                renderer.image = ({href, title, text}) => {
                    if (href.endsWith(".html")) {
                        // This is an embed, use an iframe
                        return `<iframe src="${href}" width="100%" height="100%" frameborder="0" allowtransparency="true"></iframe>`;
                    }
                    if (href.endsWith(".mov")) {
                        return `<video src="${href}" width="100%" height="100%" controls loop autoplay playsinline disablepictureinpicture disableremoteplayback muted></video>`;
                    }
                    let html = `<img src="${href}"`;
                    if (title) {
                        html += ` title="${title}"`;
                    }
                    html += ` alt="${text}">`;
                    return html;
                };

                marked.use({ renderer, breaks: true });

                var bodyHtml;
                if (window.marked && window.marked.parse) {
                    bodyHtml = window.marked.parse(markdown);
                } else if (window.marked) {
                    bodyHtml = window.marked(markdown);
                }
                return bodyHtml;
            }

            function populateGrid(gridData) {
                if (!gridData || !gridData.length) return;

                gridData.sort(function (a, b) {
                    return a.order - b.order;
                });

                var grid = document.getElementById("grid");
                if (!grid) return;

                for (var i = 0; i < gridData.length; i++) {
                    var item = gridData[i];

                    var isClickable = !item.contentInGrid && item.markdown && !item.disable;

                    var classes = ["tile"];
                    classes.push(`col-span-${item.width}`);
                    classes.push(`row-span-${item.height}`);
                    classes.push(`tile--${item.color}`);
                    if (item.extraClass) {
                        classes.push(`tile--${item.extraClass}`);
                    }
                    if (isClickable) {
                        classes.push("tile--clickable");
                    }

                    var tile = document.createElement("div");
                    tile.className = classes.join(" ");

                    const headerEl = document.createElement("div");
                    headerEl.classList.add("tile__header");
                    headerEl.classList.add("show-classic");
                    headerEl.textContent = item.title.toUpperCase();
                    tile.appendChild(headerEl);

                    if (item.chip) {
                        var chipEl = document.createElement("iframe");
                        chipEl.className = "tile__chip";
                        chipEl.src = `chips/${item.chip}.html`;
                        chipEl.width = "100%";
                        chipEl.height = "100%";
                        chipEl.frameBorder = "0";
                        chipEl.setAttribute("allowtransparency", "true");
                        chipEl.addEventListener("load", function() {
                            broadcastTheme();
                        });
                        tile.appendChild(chipEl);

                        (function(iframe, tileEl) {
                            tileEl.addEventListener("mouseenter", function() {
                                if (iframe.contentWindow) {
                                    iframe.contentWindow.postMessage({ type: "hover", value: true }, "*");
                                }
                            });
                            tileEl.addEventListener("mouseleave", function() {
                                if (iframe.contentWindow) {
                                    iframe.contentWindow.postMessage({ type: "hover", value: false }, "*");
                                }
                            });
                            tileEl.addEventListener("mousemove", function(e) {
                                if (iframe.contentWindow) {
                                    var rect = tileEl.getBoundingClientRect();
                                    var x = (e.clientX - rect.left) / rect.width;
                                    var y = (e.clientY - rect.top) / rect.height;
                                    iframe.contentWindow.postMessage({ type: "mousemove", x: x, y: y }, "*");
                                }
                            });
                        })(chipEl, tile);
                    }

                    const contentEl = document.createElement("div");
                    contentEl.className = "tile__content";

                    let anyContent = false;
                    if (item.code) {
                        var codeEl = document.createElement("span");
                        codeEl.className = "tile__code";
                        codeEl.textContent = item.code;
                        contentEl.appendChild(codeEl);
                        anyContent = true;
                    }

                    if (item.category) {
                        var labelEl = document.createElement("span");
                        labelEl.className = "tile__label";
                        labelEl.textContent = item.category.toUpperCase();
                        contentEl.appendChild(labelEl);
                        anyContent = true;
                    }

                    if (item.title) {
                        var titleEl = document.createElement("h2");
                        titleEl.innerHTML = item.title.toUpperCase();
                        contentEl.appendChild(titleEl);
                        anyContent = true;
                    }

                    if (item.subtitle) {
                        var subtitleEl = document.createElement("p");
                        subtitleEl.textContent = item.subtitle;
                        contentEl.appendChild(subtitleEl);
                        anyContent = true;
                    }

                    if (item.themes) {
                        var themesEl = document.createElement("div");
                        themesEl.className = "themes";
                        const themesElInner = document.createElement("div");
                        themesElInner.className = "themes__inner";
                        
                        var currentEl = document.createElement("div");
                        currentEl.className = "theme theme--current";
                        themesElInner.appendChild(currentEl);
                        
                        THEMES.forEach(theme => {
                            var themeEl = document.createElement("div");
                            themeEl.classList.add("theme");
                            themeEl.classList.add(`theme--${theme}`);
                            themeEl.onclick = () => {
                                setTheme(theme);
                            };
                            themesElInner.appendChild(themeEl);
                        });
                        themesEl.appendChild(themesElInner);
                        contentEl.appendChild(themesEl);
                        anyContent = true;
                    }

                    if (anyContent) {
                        tile.appendChild(contentEl);
                    }

                    if (item.contentInGrid && item.markdown) {
                        var markdownEl = document.createElement("div");
                        markdownEl.className = "markdown";
                        markdownEl.innerHTML = renderItemMarkdown(item.markdown);
                        tile.appendChild(markdownEl);
                    }

                    if (isClickable) {
                        (function(itemData, tileEl) {
                            tileEl.addEventListener("click", function(e) {
                                openModal(itemData, tileEl);
                            });
                        })(item, tile);
                    }

                    grid.appendChild(tile);
                }
            }

            if (typeof GRID_DATA !== "undefined") {
                populateGrid(GRID_DATA);
            } else {
                console.error("GRID_DATA is not defined. Run build-grid.js to generate grid-data.js.");
            }

            var modal = document.getElementById("modal");
            var modalPhantom = modal.querySelector(".modal__phantom");
            var modalClose = modal.querySelector(".modal__close");
            var modalContent = modal.querySelector(".modal__content");
            var modalCode = modal.querySelector(".modal__code");
            var modalCategory = modal.querySelector(".modal__category");
            var modalTitle = modal.querySelector(".modal__title");
            var modalSubtitle = modal.querySelector(".modal__subtitle");
            var modalBody = modal.querySelector(".modal__body");

            function findItemByCode(code) {
                if (!code || typeof GRID_DATA === "undefined") return null;
                for (var i = 0; i < GRID_DATA.length; i++) {
                    if (GRID_DATA[i].code === code) return GRID_DATA[i];
                }
                return null;
            }

            function openModal(item, tileEl) {
                modal.classList.remove("modal--black", "modal--orange", "modal--white");
                modal.classList.add("modal--" + (item.color || "black"));

                if (tileEl) {
                    var rect = tileEl.getBoundingClientRect();
                    modalPhantom.style.transition = "none";
                    modalPhantom.style.top = rect.top + "px";
                    modalPhantom.style.left = rect.left + "px";
                    modalPhantom.style.width = rect.width + "px";
                    modalPhantom.style.height = rect.height + "px";
                } else {
                    modalPhantom.style.transition = "none";
                    modalPhantom.style.top = "50%";
                    modalPhantom.style.left = "50%";
                    modalPhantom.style.width = "0";
                    modalPhantom.style.height = "0";
                }
                
                modalContent.style.opacity = "0";
                modalClose.style.opacity = "0";

                modalCode.textContent = item.code || "";
                modalCode.style.display = item.code ? "" : "none";

                modalCategory.textContent = item.category ? item.category.toUpperCase() : "";
                modalCategory.style.display = item.category ? "" : "none";

                modalTitle.innerHTML = item.title ? item.title.toUpperCase().replace("\n", "<br>") : "";
                modalTitle.style.display = item.title ? "" : "none";

                modalSubtitle.textContent = item.subtitle || "";
                modalSubtitle.style.display = item.subtitle ? "" : "none";

                modalBody.innerHTML = item.markdown ? renderItemMarkdown(item.markdown) : "";
                modalBody.style.display = item.markdown ? "" : "none";

                modal.hidden = false;
                modal.scrollTop = 0;
                document.documentElement.classList.add("modal-open");

                if (item.code) {
                    window.location.hash = encodeURIComponent(item.code);
                }

                requestAnimationFrame(function() {
                    requestAnimationFrame(function() {
                        modalPhantom.style.transition = "all 0.35s cubic-bezier(0.4, 0, 0.2, 1)";
                        modalPhantom.style.top = "0";
                        modalPhantom.style.left = "0";
                        modalPhantom.style.width = "100%";
                        modalPhantom.style.height = "100%";
                    });
                });

                setTimeout(function() {
                    modal.classList.add("modal--expanded");
                    modalContent.style.transition = "opacity 0.2s ease";
                    modalContent.style.opacity = "1";
                    modalClose.style.transition = "opacity 0.2s ease";
                    modalClose.style.opacity = "1";
                }, 280);
            }

            function closeModal() {
                modal.hidden = true;
                modal.classList.remove("modal--expanded");
                modalBody.innerHTML = "";
                document.documentElement.classList.remove("modal-open");
                window.location.hash = "";
            }

            var hash = window.location.hash;
            if (hash && hash.length > 1) {
                var code = decodeURIComponent(hash.substring(1));
                var item = findItemByCode(code);
                if (item) {
                    openModal(item, null);
                }
            }

            modalClose.addEventListener("click", closeModal);

            modal.addEventListener("click", function(e) {
                if (e.target === modal) {
                    closeModal();
                }
            });

            document.addEventListener("keydown", function(e) {
                if (e.key === "Escape" && !modal.hidden && !document.getElementById("image-zoom").classList.contains("image-zoom--active")) {
                    closeModal();
                }
            });

            var imageZoom = document.getElementById("image-zoom");
            var imageZoomImg = imageZoom.querySelector(".image-zoom__img");
            var imageZoomClose = imageZoom.querySelector(".image-zoom__close");

            function openImageZoom(src, alt) {
                imageZoomImg.src = src;
                imageZoomImg.alt = alt || "";
                imageZoom.classList.add("image-zoom--active");
                imageZoomImg.onload = function() {
                    var inner = imageZoom.querySelector(".image-zoom__inner");
                    if (imageZoomImg.naturalWidth > window.innerWidth || imageZoomImg.naturalHeight > window.innerHeight) {
                        var scrollX = Math.max(0, (inner.scrollWidth - window.innerWidth) / 2);
                        var scrollY = Math.max(0, (inner.scrollHeight - window.innerHeight) / 2);
                        imageZoom.scrollLeft = scrollX;
                        imageZoom.scrollTop = scrollY;
                    }
                };
            }

            function closeImageZoom() {
                imageZoom.classList.remove("image-zoom--active");
                imageZoomImg.src = "";
            }

            imageZoomClose.addEventListener("click", function(e) {
                e.stopPropagation();
                closeImageZoom();
            });

            imageZoom.addEventListener("click", function(e) {
                if (e.target === imageZoom || e.target === imageZoomImg || e.target.classList.contains("image-zoom__inner")) {
                    closeImageZoom();
                }
            });

            document.addEventListener("keydown", function(e) {
                if (e.key === "Escape" && imageZoom.classList.contains("image-zoom--active")) {
                    closeImageZoom();
                }
            });

            modalBody.addEventListener("click", function(e) {
                if (e.target.tagName === "IMG") {
                    e.preventDefault();
                    e.stopPropagation();
                    openImageZoom(e.target.src, e.target.alt);
                }
            });
        </script>
        <script>
            let screensaverTimeout = null;
            let screensaverOn = false;
            let screensaverScriptsLoaded = false;
            const timeout = 10 * 60 * 1000;

            window.addEventListener('mousemove', (e) => {
                stopScreensaver();
                if (e.altKey && e.ctrlKey && e.shiftKey) {
                    // Debugging, press alt+ctrl+shift while moving the mouse a bit to start screensaver immediately
                    startScreensaver();
                    return;
                }
            });

            window.addEventListener('keydown', (e) => {
                stopScreensaver();
            });

            window.addEventListener('mousedown', () => {
                stopScreensaver();
            });

            window.addEventListener('touchstart', () => {
                stopScreensaver();
            });

            window.addEventListener('scroll', () => {
                stopScreensaver();
            });

            async function startScreensaver() {
                if (screensaverOn) {
                    return;
                }
                screensaverOn = true;

                if (!screensaverScriptsLoaded) {
                    await loadScreensaverScripts();
                    screensaverScriptsLoaded = true;
                }

                document.getElementById("screensaver-canvas-container").style.display = "block";
                reset();
                animate();
            }

            function stopScreensaver() {
                clearTimeout(screensaverTimeout);
                screensaverTimeout = setTimeout(function () {
                    startScreensaver();
                }, timeout);
                if (!screensaverOn) {
                    return;
                }
                screensaverOn = false;
                
                document.getElementById("screensaver-canvas-container").style.display = "none";
                reset();
            }

            async function loadScreensaverScripts() {
                let script = document.createElement('script');
                script.src = "https://cdnjs.cloudflare.com/ajax/libs/three.js/98/three.min.js";
                script.integrity = "sha256-MbIcpOhIEGLabqntH1B7ZgE7a6V0TrocmKouz1npT1g=";
                script.crossOrigin = "anonymous";
                document.body.appendChild(script);

                await new Promise((resolve) => {
                    script.onload = resolve;
                });

                let screensaver = document.createElement('script');
                screensaver.src = "screensaver.js";
                document.body.appendChild(screensaver);

                await new Promise((resolve) => {
                    screensaver.onload = resolve;
                });
            }
        </script>
        <script>
            (function() {
                const pixel = document.getElementById('secret-pixel');
                pixel.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const popup = document.createElement('div');
                    popup.className = 'secret-popup';
                    popup.innerHTML = `
                        <div class="secret-popup__content">
                            <h3>You found me!</h3>
                            <p>Good eye! You've found the secret pixel.</p>
                            <p>Here, have a cookie üç™, it goes stale in 3 days</p>
                            <button class="secret-popup__close">Close</button>
                        </div>
                    `;
                    document.body.appendChild(popup);
                    
                    popup.querySelector('.secret-popup__close').addEventListener('click', function() {
                        popup.remove();
                    });
                
                    // Give an actual cookie
                    // No it doesn't do anything
                    document.cookie = "has-a-cookie=true; max-age=259200; path=/";
                    
                    popup.addEventListener('click', function(e) {
                        if (e.target === popup) {
                            popup.remove();
                        }
                    });
                });
            })();
        </script>
        <script>
            /* Mobile: trigger hover on centered chip tiles since touch devices can't hover */
            (function() {
                if (window.matchMedia('(max-width: 600px)').matches) {
                    let currentHoveredTile = null;

                    function updateCenteredChip() {
                        const scrollY = window.scrollY || window.pageYOffset;
                        const maxScroll = document.documentElement.scrollHeight - window.innerHeight;
                        const atTop = scrollY < 10;
                        const atBottom = scrollY >= maxScroll - 10;

                        let closestTile = null;
                        const viewportCenter = window.innerHeight / 2;

                        if (!atTop && !atBottom) {
                            const tiles = document.querySelectorAll('.tile:has(.tile__chip)');
                            let closestDistance = Infinity;

                            tiles.forEach(tile => {
                                const rect = tile.getBoundingClientRect();
                                const tileCenter = rect.top + rect.height / 2;
                                const distance = Math.abs(tileCenter - viewportCenter);
                                
                                if (distance < closestDistance && rect.top < window.innerHeight && rect.bottom > 0) {
                                    closestDistance = distance;
                                    closestTile = tile;
                                }
                            });
                        }

                        if (closestTile !== currentHoveredTile) {
                            if (currentHoveredTile) {
                                const oldIframe = currentHoveredTile.querySelector('.tile__chip');
                                if (oldIframe && oldIframe.contentWindow) {
                                    oldIframe.contentWindow.postMessage({ type: "hover", value: false }, "*");
                                }
                            }
                            if (closestTile) {
                                const newIframe = closestTile.querySelector('.tile__chip');
                                if (newIframe && newIframe.contentWindow) {
                                    newIframe.contentWindow.postMessage({ type: "hover", value: true }, "*");
                                }
                            }
                            currentHoveredTile = closestTile;
                        }

                        if (currentHoveredTile) {
                            const rect = currentHoveredTile.getBoundingClientRect();
                            const iframe = currentHoveredTile.querySelector('.tile__chip');
                            if (iframe && iframe.contentWindow) {
                                // y goes from 1 (viewport center at tile bottom) to 0 (viewport center at tile top)
                                const y = (viewportCenter - rect.top) / rect.height;
                                const clampedY = Math.max(0, Math.min(1, y));
                                iframe.contentWindow.postMessage({ type: "mousemove", x: 0.5, y: clampedY }, "*");
                            }
                        }
                    }

                    window.addEventListener('scroll', updateCenteredChip, { passive: true });
                    window.addEventListener('resize', updateCenteredChip, { passive: true });
                }
            })();
        </script>
        <script>
            /* Only works on iOS and other browsers that allow scrolling past the bottom of the page */
            const msgs = [
                "Cold",
                "Warmer",
                "Hot!",
                "HOT HOT HOT!",
            ]
            let leaving = false;
            window.addEventListener('scroll', () => {
                let maxScroll = document.documentElement.scrollHeight - document.documentElement.clientHeight;
                let subfooter = document.getElementById('subfooter-msg');
                let i = Math.floor((window.scrollY - maxScroll - 50) / 50);
                if (i < 0) {
                    subfooter.style.opacity = 0;
                    subfooter.innerText = ".";
                }
                else if (i >= msgs.length) {
                    if (leaving) {
                        return;
                    }
                    leaving = true; // Prevents the page from redirecting multiple times
                    
                    // You can probably guess what this does
                    window.location.href = atob("aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1kUXc0dzlXZ1hjUQ==");
                }
                else {
                    subfooter.innerText = msgs[i];
                    subfooter.style.opacity = 1;
                }
            });
        </script>
        <script type="text/javascript">
            // <![CDATA[
            var sparks=75; // how many sparks per clicksplosion
            var speed=33; // how fast - smaller is faster
            var bangs=5; // how many can be launched simultaneously (note that using too many can slow the script down)
            var colours=new Array('#03f', '#f03', '#0e0', '#93f', '#0cf', '#f93', '#f0c'); 
            //                     blue    red     green   purple  cyan    orange  pink
            
            /****************************
            *   Clicksplosion Effect    *
            *(c)2012-3 mf2fm web-design *
            *  http://www.mf2fm.com/rv  *
            * DON'T EDIT BELOW THIS BOX *
            ****************************/
            var intensity=new Array();
            var Xpos=new Array();
            var Ypos=new Array();
            var dX=new Array();
            var dY=new Array();
            var stars=new Array();
            var decay=new Array();
            var timers=new Array();
            var swide=800;
            var shigh=600;
            var sleft=sdown=0;
            var count=0;
            
            function addLoadEvent(funky) {
              var oldonload=window.onload;
              if (typeof(oldonload)!='function') window.onload=funky;
              else window.onload=function() {
                if (oldonload) oldonload();
                funky();
              }
            }
            
            addLoadEvent(clicksplode);
            
            function clicksplode() { if (document.getElementById) {
              var i, j;
              window.onscroll=set_scroll;
              window.onresize=set_width;
              document.onclick=eksplode;
              set_width();
              set_scroll();
              for (i=0; i<bangs; i++) for (j=sparks*i; j<sparks+sparks*i; j++) {
                stars[j]=createDiv('*', 13);
                document.body.appendChild(stars[j]);
              }
            }}
            
            function createDiv(char, size) {
              var div, sty;
              div=document.createElement('div');
              sty=div.style;
              sty.font=size+'px monospace';
              sty.position='absolute';
              sty.backgroundColor='transparent';
              sty.visibility='hidden';
              sty.zIndex='10000000';
              div.appendChild(document.createTextNode(char));
              return (div);
            }
            
            function bang(N) {
              var i, Z, A=0;
              for (i=sparks*N; i<sparks*(N+1); i++) { 
                if (decay[i]) {
                  Z=stars[i].style;
                  Xpos[i]+=dX[i];
                  Ypos[i]+=(dY[i]+=1.25/intensity[N]);
                  if (Xpos[i]>=swide || Xpos[i]<0 || Ypos[i]>=shigh+sdown || Ypos[i]<0) decay[i]=1;
                  else {
                    Z.left=Xpos[i]+'px';
                    Z.top=Ypos[i]+'px';
                  }
                  if (decay[i]==15) Z.fontSize='7px';
                  else if (decay[i]==7) Z.fontSize='2px';
                  else if (decay[i]==1) Z.visibility='hidden';
                  decay[i]--;
                }
                else A++;
              }
              if (A!=sparks) timers[N]=setTimeout('bang('+N+')', speed);
            }
            
            function eksplode(e) { 
              if (!document.documentElement.className.includes("rainbow") ) {
                return;
              }
              var x, y, i, M, Z, N;
              set_scroll();
              y=(e)?e.pageY:event.y+sdown;
              x=(e)?e.pageX:event.x+sleft;
              N=++count%bangs;
              M=Math.floor(Math.random()*3*colours.length);
              intensity[N]=5+Math.random()*4;
              for (i=N*sparks; i<(N+1)*sparks; i++) {
                Xpos[i]=x;
                Ypos[i]=y-5;
                dY[i]=(Math.random()-0.5)*intensity[N];
                dX[i]=(Math.random()-0.5)*(intensity[N]-Math.abs(dY[i]))*1.25;
                decay[i]=16+Math.floor(Math.random()*16);
                Z=stars[i].style;
                if (M<colours.length) Z.color=colours[i%2?count%colours.length:M];
                else if (M<2*colours.length) Z.color=colours[count%colours.length];
                else Z.color=colours[i%colours.length];
                Z.fontSize='13px';
                Z.visibility='visible';
              }
              clearTimeout(timers[N]);
              bang(N);
            } 
            
            function set_width() {
              var sw_min=999999;
              var sh_min=999999;
              if (document.documentElement && document.documentElement.clientWidth) {
                if (document.documentElement.clientWidth>0) sw_min=document.documentElement.clientWidth;
                if (document.documentElement.clientHeight>0) sh_min=document.documentElement.clientHeight;
              }
              if (typeof(self.innerWidth)=='number' && self.innerWidth) {
                if (self.innerWidth>0 && self.innerWidth<sw_min) sw_min=self.innerWidth;
                if (self.innerHeight>0 && self.innerHeight<sh_min) sh_min=self.innerHeight;
              }
              if (document.body.clientWidth) {
                if (document.body.clientWidth>0 && document.body.clientWidth<sw_min) sw_min=document.body.clientWidth;
                if (document.body.clientHeight>0 && document.body.clientHeight<sh_min) sh_min=document.body.clientHeight;
              }
              if (sw_min==999999 || sh_min==999999) {
                sw_min=800;
                sh_min=600;
              }
              swide=sw_min-7;
              shigh=sh_min-7;
            }
            
            function set_scroll() {
              if (typeof(self.pageYOffset)=='number') {
                sdown=self.pageYOffset;
                sleft=self.pageXOffset;
              }
              else if (document.body && (document.body.scrollTop || document.body.scrollLeft)) {
                sdown=document.body.scrollTop;
                sleft=document.body.scrollLeft;
              }
              else if (document.documentElement && (document.documentElement.scrollTop || document.documentElement.scrollLeft)) {
                sleft=document.documentElement.scrollLeft;
                sdown=document.documentElement.scrollTop;
              }
              else {
                sdown=0;
                sleft=0;
              }
            }
            // ]]>
            </script>
    </body>
</html>
